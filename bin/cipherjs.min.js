BigInteger.valueOf=nbv;BigInteger.prototype.toByteArrayUnsigned=function(){var a=this.abs().toByteArray();if(a.length){if(a[0]==0){a=a.slice(1)}return a.map(function(b){return(b<0)?b+256:b})}else{return a}};BigInteger.fromByteArrayUnsigned=function(a){if(!a.length){return a.valueOf(0)}else{if(a[0]&128){return new BigInteger([0].concat(a))}else{return new BigInteger(a)}}};BigInteger.prototype.toByteArraySigned=function(){var a=this.abs().toByteArrayUnsigned();var b=this.compareTo(BigInteger.ZERO)<0;if(b){if(a[0]&128){a.unshift(128)}else{a[0]|=128}}else{if(a[0]&128){a.unshift(0)}}return a};BigInteger.fromByteArraySigned=function(a){if(a[0]&128){a[0]&=127;return BigInteger.fromByteArrayUnsigned(a).negate()}else{return BigInteger.fromByteArrayUnsigned(a)}};function util_bytesToHex(a){for(var c=[],b=0;b<a.length;b++){c.push((a[b]>>>4).toString(16));c.push((a[b]&15).toString(16))}return c.join("")}function ec_keys(){this.generateKeypairAsync=function(i,s,k){var l=getCurveByName(i);var j=l.getCurve();var d=j.getQ();var p=j.getA().toBigInteger();var o=j.getB().toBigInteger();var f=l.getG().getX().toBigInteger();var e=l.getG().getY().toBigInteger();var h=l.getN();var g=new ECCurveFp(d,p,o);var m=new ECPointFp(g,g.fromBigInteger(f),g.fromBigInteger(e));var r=ecHandler.keys.generateSecretValue(h);k={callback:s,outercarrier:k,priv:r,curve:i};m.multiplyAsync(r,function(u,w){var b=w.priv;var n=u;var t=w.curve;var v=w.callback;var q=w.outercarrier;var a=ecHandler.keys.serializeKeypair(b,n,t);window.setTimeout(function(){v(a,q)},EC_async_timeout)},k)};this.generateKeypair=function(i){var l=getCurveByName(i);var j=l.getCurve();var d=j.getQ();var p=j.getA().toBigInteger();var o=j.getB().toBigInteger();var f=l.getG().getX().toBigInteger();var e=l.getG().getY().toBigInteger();var h=l.getN();var g=new ECCurveFp(d,p,o);var m=new ECPointFp(g,g.fromBigInteger(f),g.fromBigInteger(e));var r=ecHandler.keys.generateSecretValue(h);var k=m.multiply(r);var s=ecHandler.keys.serializeKeypair(r,k,i);return s};this.serializeKeypair=function(b,c,a){b=ecHandler.keys.serializePrivateKey(b,a);c=ecHandler.keys.serializePublicKey(c,a);return{priv:b,pub:c}};this.deserializeKeypair=function(a,b){a=ecHandler.keys.deserializePrivateKey(a);b=ecHandler.keys.deserializePublicKey(b);return{priv:a,pub:b}};this.serializePublicKey=function(a,d){var c=a.getX().toBigInteger().toString();var b=a.getY().toBigInteger().toString();a={x:c,y:b,curve:d};a=JSON.stringify(a);return a};this.deserializePublicKey=function(g){g=JSON.parse(g);var l=g.x;var k=g.y;l=new BigInteger(l);k=new BigInteger(k);var f=g.curve;var i=getCurveByName(f);var h=i.getCurve();var d=h.getQ();var m=h.getA().toBigInteger();var j=h.getB().toBigInteger();var e=new ECCurveFp(d,m,j);g=new ECPointFp(e,e.fromBigInteger(l),e.fromBigInteger(k));return g};this.serializePrivateKey=function(a,b){a=a.toString();a={secret:a,curve:b};a=JSON.stringify(a);return a};this.deserializePrivateKey=function(a){a=JSON.parse(a);a=new BigInteger(a.secret);return a};this.generateSecretValue=function(d){var a=new SecureRandom();var b=d.subtract(BigInteger.ONE);var c=new BigInteger(d.bitLength(),a);return c.mod(b).add(BigInteger.ONE)}}var ecHandler=new Object();ecHandler.keys=new ec_keys();function ec_dh(){this.getSharedSecret=function(b,c){c=ecHandler.keys.deserializePublicKey(c);b=ecHandler.keys.deserializePrivateKey(b);var a=c.multiply(b);a=ecHandler.dh.serializeSecret(a);return a};this.getSharedSecretAsync=function(a,b,d,c){b=ecHandler.keys.deserializePublicKey(b);a=ecHandler.keys.deserializePrivateKey(a);b.multiplyAsync(a,function(e,h){e=ecHandler.dh.serializeSecret(e);var g=h.callback;var f=h.outercarrier;setTimeout(function(){g(e,f)},EC_async_timeout)},{callback:d,outercarrier:c})};this.serializeSecret=function(b){var a=b.getX().toBigInteger().toString();var c=b.getY().toBigInteger().toString();b={x:a,y:c};b=JSON.stringify(b);return b}}ecHandler.dh=new ec_dh();function ec_elgamal(){this.kem=function(e){var b=(JSON.parse(e)).curve;var f=getCurveByName(b);e=ecHandler.keys.deserializePublicKey(e);var g=f.getN();var d=ecHandler.keys.generateSecretValue(g);var a=f.getG().multiply(d);a=ecHandler.elgamal.serializeTag(a,b);var c=e.multiply(d);c=ecHandler.keys.serializePublicKey(c);c=sjcl.hash.sha256.hash(c);return{key:c,tag:a}};this.kemAsync=function(c,g,d){var a=(JSON.parse(c)).curve;var e=getCurveByName(a);c=ecHandler.keys.deserializePublicKey(c);var f=e.getN();var b=ecHandler.keys.generateSecretValue(f);d={callback:g,outercarrier:d,curvename:a,remotePub:c,sec:b};e.getG().multiplyAsync(b,function(i,l){var h=l.curvename;var k=l.remotePub;var j=l.sec;i=ecHandler.elgamal.serializeTag(i,h);l.tag=i;k.multiplyAsync(j,function(o,r){o=ecHandler.keys.serializePublicKey(o);o=sjcl.hash.sha256.hash(o);var m=r.tag;var q=r.callback;var p=r.outercarrier;var n={key:o,tag:m};setTimeout(function(){q(n,p)},EC_async_timeout)},l)},d)};this.unkem=function(e,p){e=ecHandler.keys.deserializePrivateKey(e);p=JSON.parse(p);var g=p.curve;var i=getCurveByName(p.curve);var l=new BigInteger(p.x);var j=new BigInteger(p.y);var h=i.getCurve();var d=h.getQ();var m=h.getA().toBigInteger();var k=h.getB().toBigInteger();var f=new ECCurveFp(d,m,k);var n=new ECPointFp(f,f.fromBigInteger(l),f.fromBigInteger(j));p=n;var o=p.multiply(e);o=ecHandler.keys.serializePublicKey(o);o=sjcl.hash.sha256.hash(o);return o};this.unkemAsync=function(e,r,p,i){e=ecHandler.keys.deserializePrivateKey(e);r=JSON.parse(r);var g=r.curve;var j=getCurveByName(r.curve);var m=new BigInteger(r.x);var k=new BigInteger(r.y);var h=j.getCurve();var d=h.getQ();var n=h.getA().toBigInteger();var l=h.getB().toBigInteger();var f=new ECCurveFp(d,n,l);var o=new ECPointFp(f,f.fromBigInteger(m),f.fromBigInteger(k));r=o;i={callback:p,outercarrier:i};r.multiplyAsync(e,function(a,s){a=ecHandler.keys.serializePublicKey(a);a=sjcl.hash.sha256.hash(a);var q=s.callback;var b=s.outercarrier;setTimeout(function(){q(a,b)},EC_async_timeout)},i)};this.serializeTag=function(a,c){var b=ecHandler.keys.serializePublicKey(a,c);return b};this.deserializeTag=function(a){var b=getCurveByName((JSON.parse(a)).curve);console.log(b);a=ecHandler.keys.deserializePublicKey(a);console.log(a);return{curve:b,tag:a}}}ecHandler.elgamal=new ec_elgamal();function integerToBytes(c,a){var b=c.toByteArrayUnsigned();if(a<b.length){b=b.slice(b.length-a)}else{while(a>b.length){b.unshift(0)}}return b}ECFieldElementFp.prototype.getByteLength=function(){return Math.floor((this.toBigInteger().bitLength()+7)/8)};ECPointFp.prototype.getEncoded=function(c){var a=this.getX().toBigInteger();var d=this.getY().toBigInteger();var b=integerToBytes(a,32);if(c){if(d.isEven()){b.unshift(2)}else{b.unshift(3)}}else{b.unshift(4);b=b.concat(integerToBytes(d,32))}return b};ECPointFp.decodeFrom=function(g,c){var f=c[0];var e=c.length-1;var d=c.slice(1,1+e/2);var b=c.slice(1+e/2,1+e);d.unshift(0);b.unshift(0);var a=new BigInteger(d);var h=new BigInteger(b);return new ECPointFp(g,g.fromBigInteger(a),g.fromBigInteger(h))};ECPointFp.prototype.add2D=function(c){if(this.isInfinity()){return c}if(c.isInfinity()){return this}if(this.x.equals(c.x)){if(this.y.equals(c.y)){return this.twice()}return this.curve.getInfinity()}var g=c.x.subtract(this.x);var e=c.y.subtract(this.y);var a=e.divide(g);var d=a.square().subtract(this.x).subtract(c.x);var f=a.multiply(this.x.subtract(d)).subtract(this.y);return new ECPointFp(this.curve,d,f)};ECPointFp.prototype.twice2D=function(){if(this.isInfinity()){return this}if(this.y.toBigInteger().signum()==0){return this.curve.getInfinity()}var b=this.curve.fromBigInteger(BigInteger.valueOf(2));var e=this.curve.fromBigInteger(BigInteger.valueOf(3));var a=this.x.square().multiply(e).add(this.curve.a).divide(this.y.multiply(b));var c=a.square().subtract(this.x.multiply(b));var d=a.multiply(this.x.subtract(c)).subtract(this.y);return new ECPointFp(this.curve,c,d)};ECPointFp.prototype.multiply2D=function(b){if(this.isInfinity()){return this}if(b.signum()==0){return this.curve.getInfinity()}var g=b;var f=g.multiply(new BigInteger("3"));var l=this.negate();var d=this;var c;for(c=f.bitLength()-2;c>0;--c){d=d.twice();var a=f.testBit(c);var j=g.testBit(c);if(a!=j){d=d.add2D(a?this:l)}}return d};ECPointFp.prototype.isOnCurve=function(){var d=this.getX().toBigInteger();var i=this.getY().toBigInteger();var f=this.curve.getA().toBigInteger();var c=this.curve.getB().toBigInteger();var h=this.curve.getQ();var e=i.multiply(i).mod(h);var g=d.multiply(d).multiply(d).add(f.multiply(d)).add(c).mod(h);return e.equals(g)};ECPointFp.prototype.toString=function(){return"("+this.getX().toBigInteger().toString()+","+this.getY().toBigInteger().toString()+")"};ECPointFp.prototype.validate=function(){var c=this.curve.getQ();if(this.isInfinity()){throw new Error("Point is at infinity.")}var a=this.getX().toBigInteger();var b=this.getY().toBigInteger();if(a.compareTo(BigInteger.ONE)<0||a.compareTo(c.subtract(BigInteger.ONE))>0){throw new Error("x coordinate out of bounds")}if(b.compareTo(BigInteger.ONE)<0||b.compareTo(c.subtract(BigInteger.ONE))>0){throw new Error("y coordinate out of bounds")}if(!this.isOnCurve()){throw new Error("Point is not on the curve.")}if(this.multiply(c).isInfinity()){throw new Error("Point is not a scalar multiple of G.")}return true};function dmp(a){if(!(a instanceof BigInteger)){a=a.toBigInteger()}var b=util_bytesToHex(a.toByteArrayUnsigned());return b}var P_OVER_FOUR=null;function ec_ecdsa(){this.ecparams=getCurveByName("brainpoolP512r1");this.rng=new SecureRandom();this.setCurve=function(a){ecHandler.ecdsa.ecparams=getCurveByName(a);return true};this.getBigRandom=function(a){return new BigInteger(a.bitLength(),ecHandler.ecdsa.rng).mod(a.subtract(BigInteger.ONE)).add(BigInteger.ONE)};this.sign=function(f,l){if(typeof l=="string"||typeof l=="String"){ecHandler.ecdsa.setCurve((JSON.parse(l)).curve);l=ecHandler.keys.deserializePrivateKey(l)}var i=l;var b=ecHandler.ecdsa.ecparams.getN();var h=BigInteger.fromByteArrayUnsigned(f);do{var c=ecHandler.ecdsa.getBigRandom(b);var j=ecHandler.ecdsa.ecparams.getG();var g=j.multiply(c);var a=g.getX().toBigInteger().mod(b)}while(a.compareTo(BigInteger.ZERO)<=0);var m=c.modInverse(b).multiply(h.add(i.multiply(a))).mod(b);return ecHandler.ecdsa.serializeSig(a,m)};this.signAsync=function(f,a,i,b){if(typeof a=="string"||typeof a=="String"){ecHandler.ecdsa.setCurve((JSON.parse(a)).curve);a=ecHandler.keys.deserializePrivateKey(a)}var g=a;var h=ecHandler.ecdsa.ecparams.getN();var c=BigInteger.fromByteArrayUnsigned(f);b={callback:i,outercarrier:b,d:g,n:h,e:c,k:null,G:null,Q:null,r:null};ecHandler.ecdsa.signAsyncLoop(b)};this.signAsyncLoop=function(g){g.k=ecHandler.ecdsa.getBigRandom(g.n);g.G=ecHandler.ecdsa.ecparams.getG();g.Q=g.G.multiply(g.k);g.r=g.Q.getX().toBigInteger().mod(g.n);if(g.r.compareTo(BigInteger.ZERO)<=0){setTimeout(function(){ecHandler.ecdsa.signAsyncLoop(g)},EC_async_timeout)}else{var c=g.k;var b=g.n;var f=g.e;var h=g.d;var a=g.r;var l=c.modInverse(b).multiply(f.add(h.multiply(a))).mod(b);var j=ecHandler.ecdsa.serializeSig(a,l);var i=function(){g.callback(j,g.outercarrier)};setTimeout(i,EC_async_timeout)}};this.verify=function(h,i,b){if(typeof b=="string"||typeof b=="String"){ecHandler.ecdsa.setCurve((JSON.parse(b)).curve);b=ecHandler.keys.deserializePublicKey(b)}var g=ecHandler.ecdsa.parseSig(i);var d=g.r;var a=g.s;var c=b;var f=BigInteger.fromByteArrayUnsigned(h);return ecHandler.ecdsa.verifyRaw(f,d,a,c)};this.verifyAsync=function(g,q,j,p,l){if(typeof j=="string"||typeof j=="String"){ecHandler.ecdsa.setCurve((JSON.parse(j)).curve);j=ecHandler.keys.deserializePublicKey(j)}var h=ecHandler.ecdsa.parseSig(q);var a=h.r;var t=h.s;var i=j;var k=BigInteger.fromByteArrayUnsigned(g);var f=ecHandler.ecdsa.ecparams.getN();var o=ecHandler.ecdsa.ecparams.getG();if(a.compareTo(BigInteger.ONE)<0||a.compareTo(f)>=0){p(false,l)}if(t.compareTo(BigInteger.ONE)<0||t.compareTo(f)>=0){p(false,l)}var m=t.modInverse(f);var d=k.multiply(m).mod(f);var b=a.multiply(m).mod(f);l={callback:p,outercarrier:l,Q:i,u2:b,r:a,n:f};o.multiplyAsync(d,function(e,n){n.point=e;n.Q.multiplyAsync(b,function(r,x){r=(x.point).add(r);var s=r.getX().toBigInteger().mod(x.n);var u=s.equals(x.r);var w=function(){x.callback(u,x.outercarrier)};setTimeout(w,EC_async_timeout)},n)},l)};this.verifyRaw=function(h,a,m,g){var f=ecHandler.ecdsa.ecparams.getN();var l=ecHandler.ecdsa.ecparams.getG();if(a.compareTo(BigInteger.ONE)<0||a.compareTo(f)>=0){return false}if(m.compareTo(BigInteger.ONE)<0||m.compareTo(f)>=0){return false}var i=m.modInverse(f);var d=h.multiply(i).mod(f);var b=a.multiply(i).mod(f);var j=l.multiply(d).add(g.multiply(b));var k=j.getX().toBigInteger().mod(f);return k.equals(a)};this.serializeSig=function(c,b){var d=c.toByteArraySigned();var a=b.toByteArraySigned();var e=[];e.push(2);e.push(d.length);e=e.concat(d);e.push(2);e.push(a.length);e=e.concat(a);e.unshift(e.length);e.unshift(48);return e};this.parseSig=function(f){var e;if(f[0]!=48){throw new Error("Signature not a valid DERSequence")}e=2;if(f[e]!=2){throw new Error("First element in signature must be a DERInteger")}var d=f.slice(e+2,e+2+f[e+1]);e+=2+f[e+1];if(f[e]!=2){throw new Error("Second element in signature must be a DERInteger")}var a=f.slice(e+2,e+2+f[e+1]);e+=2+f[e+1];var c=BigInteger.fromByteArrayUnsigned(d);var b=BigInteger.fromByteArrayUnsigned(a);return{r:c,s:b}};this.implShamirsTrick=function(g,c,f,b){var a=Math.max(c.bitLength(),b.bitLength());var h=g.add2D(f);var e=g.curve.getInfinity();for(var d=a-1;d>=0;--d){e=e.twice2D();e.z=BigInteger.ONE;if(c.testBit(d)){if(b.testBit(d)){e=e.add2D(h)}else{e=e.add2D(g)}}else{if(b.testBit(d)){e=e.add2D(f)}}}return e}}ecHandler.ecdsa=new ec_ecdsa();String.prototype.replaceAll=function(c,a){var b=this;return b.replace(new RegExp(c,"g"),a)};String.prototype.startsWith=function(a){return this.indexOf(a)==0};String.prototype.trim=function(){var c=this.replace(/^\s\s*/,""),a=/\s/,b=c.length;while(a.test(c.charAt(--b))){}c=c.slice(0,b+1);c=c.replace(/^\s+|\s+$/g,"");return c};String.prototype.allTrim=function(){var a=this.replace(/\s+/g," ");a=a.replace(/^\s+|\s+$/,"");a=a.replace(/^\s+|\s+$/g,"");return a};String.prototype.removeWhitespace=function(){return this.replace(/\s+/g,"")};String.prototype.removeLinebreaks=function(){return this.replace(/(\r\n|\n|\r)/gm,"")};String.prototype.removeWhitespaceAndLinebreaks=function(){var a=this.replace(/\s+/g," ");a=a.replace(/(\r\n|\n|\r)/gm,"");return a};String.prototype.between=function(f,a){var e=this.indexOf(f);var d=this.substr(e);var c=d.indexOf(a);c=e+c;if(e!=-1&&c!=-1){e=e+f.length;var b=this.length-(this.length-c)-e;return this.substr(e,b)}return null};String.prototype.chunk=function(d){var h=this;var a=0;var b=d;var j=h.length/d;var g=Math.ceil(j);var f=new Array();for(var c=0;c<g;c++){var e=h.slice(a,b);f.push(e);a=a+d;b=b+d}return f};if(typeof crypto.getRandomValues=="function"){Math.random=function(){var c=new Uint32Array(1);crypto.getRandomValues(c);var b=c[0];var a="0."+b;a=parseFloat(a);return a}}var cipherJS=new Object();cipherJS.init=new Object();cipherJS.init.entropyId=null;cipherJS.init.entropyInfoId=null;cipherJS.init.doneDOMObj=null;cipherJS.init.doneInfoDOMObj=null;cipherJS.init.init=function(d,a,b,c){windowonerrorBackup=window.onerror;window.onerror=function(){return true};cipherJS.init.entropyId=d;cipherJS.init.doneDOMObj=a;if(b!="undefined"){cipherJS.init.entropyInfoId=b}if(c!="undefined"){cipherJS.init.doneInfoDOMObj=c}document.addEventListener("touchmove",cipherJS.init.touchMoveMapper,true);document.addEventListener("mousemove",cipherJS.init.update,true);sjcl.random.startCollectors();window.setTimeout(cipherJS.init.update,0)};cipherJS.init.update=function(){var d=document.getElementById(cipherJS.init.entropyId);var e=cipherJS.init.doneDOMObj;var a=sjcl.random.getProgress(10);if(a===undefined||a==1){d.innerHTML="";d.appendChild(cipherJS.init.doneDOMObj);if(cipherJS.init.entropyInfoId!=null){var b=document.getElementById(cipherJS.init.entropyInfoId);b.innerHTML="";b.appendChild(cipherJS.init.doneInfoDOMObj)}sjcl.random.stopCollectors();document.removeEventListener("touchmove",cipherJS.init.touchMoveMapper);document.removeEventListener("mousemove",cipherJS.init.update);window.onerror=windowonerrorBackup}else{var c=Math.round((a.toFixed(2)*100));c=c+"%";d.innerHTML=c}};cipherJS.init.touchMoveMapper=function(c){var d=c.changedTouches,e=d[0],a="";switch(c.type){case"touchmove":a="mousemove";break;default:return}var b=document.createEvent("MouseEvent");b.initMouseEvent(a,true,true,window,1,e.screenX,e.screenY,e.clientX,e.clientY,false,false,false,false,0,null);e.target.dispatchEvent(b);c.preventDefault()};function cipher_js_encoding(){this.toHex=function(e,a){var c=function(k,h){h=h.toLowerCase();var j;var i;if(h=="base64"){j=sjcl.codec.base64.toBits(k);i=sjcl.codec.hex.fromBits(j);return i}else{if(h=="utf8"){j=sjcl.codec.utf8String.toBits(k);i=sjcl.codec.hex.fromBits(j);return i}else{return null}}};var b;try{b=c(e,a)}catch(g){try{b=c(e,a)}catch(f){try{b=c(e,a)}catch(d){b=c(e,a)}}}return b};this.toBase64=function(e,a){var c=function(k,h){h=h.toLowerCase();var j;var i;if(h=="hex"){j=sjcl.codec.hex.toBits(k);i=sjcl.codec.base64.fromBits(j);return i}else{if(h=="utf8"){j=sjcl.codec.utf8String.toBits(k);i=sjcl.codec.base64.fromBits(j);return i}else{return null}}};var b;try{b=c(e,a)}catch(g){try{b=c(e,a)}catch(f){try{b=c(e,a)}catch(d){b=c(e,a)}}}return b};this.toUtf8=function(e,a){var c=function(k,h){h=h.toLowerCase();var j;var i;if(h=="hex"){j=sjcl.codec.hex.toBits(k);i=sjcl.codec.utf8String.fromBits(j);return i}else{if(h=="base64"){j=sjcl.codec.base64.toBits(k);i=sjcl.codec.utf8String.fromBits(j);return i}else{return null}}};var b;try{b=c(e,a)}catch(g){try{b=c(e,a)}catch(f){try{b=c(e,a)}catch(d){b=c(e,a)}}}return b};this.toBits=function(e,a){var c=function(j,h){h=h.toLowerCase();var i;if(h=="hex"){i=sjcl.codec.hex.toBits(j);return i}else{if(h=="base64"){i=sjcl.codec.base64.toBits(j);return i}else{if(h=="utf8"){i=sjcl.codec.utf8String.toBits(j);return i}else{return null}}}};var b;try{b=c(e,a)}catch(g){try{b=c(e,a)}catch(f){try{b=c(e,a)}catch(d){b=c(e,a)}}}return b};this.fromBits=function(e,a){var c=function(i,h){h=h.toLowerCase();var j;if(h=="hex"){j=sjcl.codec.hex.fromBits(i);return j}else{if(h=="base64"){j=sjcl.codec.base64.fromBits(i);return j}else{if(h=="utf8"){j=sjcl.codec.utf8String.fromBits(i);return j}else{return null}}}};var b;try{b=c(e,a)}catch(g){try{b=c(e,a)}catch(f){try{b=c(e,a)}catch(d){b=c(e,a)}}}return b}}cipherJS.enc=new cipher_js_encoding();function cipher_js_mask(){this.mask=function(b){var a=cipherJS.enc.toBase64(b,"utf8");a=encodeURIComponent(a);return a};this.unmask=function(b){var a=decodeURIComponent(b);a=cipherJS.enc.toUtf8(a,"base64");return a}}cipherJS.mask=new cipher_js_mask();function cipher_js_random(){this.randomNumber=function(){var a=sjcl.random.randomWords(1,10);a=a[0];return a};this.mathRandom=function(){var a=sjcl.random.randomWords(1,10);a=a[0];if(a<0){a=a*(-1)}a="0."+a;a=parseFloat(a);return a};this.randomFloat=function(b,a){var c=sjcl.random.randomWords(1,10);c=c[0];if(c<0){c=c*(-1)}c="0."+c;c=parseFloat(c);c=c*(a-b)+b;return c};this.randomInteger=function(b,a){var c=sjcl.random.randomWords(1,10);c=c[0];if(c<0){c=c*(-1)}c="0."+c;c=parseFloat(c);c=c*(a-b)+b;c=Math.floor(c);return c};this.randomString=function(b,c){if(b===undefined||b=="undefined"){b=64}var g="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";if(typeof c!="undefined"){if(c=="hex"){g="012345678abcdef"}}var f=b;var a="";for(var d=f;d>0;--d){var e=sjcl.random.randomWords(1,10);e=e[0];if(e<0){e=e*(-1)}e="0."+e;e=parseFloat(e);a+=g[Math.round(e*(g.length-1))]}return a}}cipherJS.random=new cipher_js_random();function cipher_js_hash(){this.sha1=function(f,b){var d=function(k,i){var m;try{m=cipherJS.hash.sha("sha1",k,i)}catch(n){try{m=cipherJS.hash.sha("sha1",k,i)}catch(l){try{m=cipherJS.hash.sha("sha1",k,i)}catch(j){m=cipherJS.hash.sha("sha1",k,i)}}}return m};if(b!="none"){var h=d(f,b);var g=d(f,b);if(h==g){return h}else{h=d(f,b);g=d(f,b);if(h==g){return h}else{return null}}}else{var h=d(f,b);var g=d(f,b);var e=true;var a=h.length;var c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{h=d(f,b);g=d(f,b);e=true;a=h.length;c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{return null}}}};this.sha256=function(f,b){var d=function(k,i){var m;try{m=cipherJS.hash.sha("sha256",k,i)}catch(n){try{m=cipherJS.hash.sha("sha256",k,i)}catch(l){try{m=cipherJS.hash.sha("sha256",k,i)}catch(j){m=cipherJS.hash.sha("sha256",k,i)}}}return m};if(b!="none"){var h=d(f,b);var g=d(f,b);if(h==g){return h}else{h=d(f,b);g=d(f,b);if(h==g){return h}else{return null}}}else{var h=d(f,b);var g=d(f,b);var e=true;var a=h.length;var c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{h=d(f,b);g=d(f,b);e=true;a=h.length;c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{return null}}}};this.sha512=function(f,b){var d=function(k,i){var m;try{m=cipherJS.hash.sha("sha512",k,i)}catch(n){try{m=cipherJS.hash.sha("sha512",k,i)}catch(l){try{m=cipherJS.hash.sha("sha512",k,i)}catch(j){m=cipherJS.hash.sha("sha512",k,i)}}}return m};if(b!="none"){var h=d(f,b);var g=d(f,b);if(h==g){return h}else{h=d(f,b);g=d(f,b);if(h==g){return h}else{return null}}}else{var h=d(f,b);var g=d(f,b);var e=true;var a=h.length;var c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{h=d(f,b);g=d(f,b);e=true;a=h.length;c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{return null}}}};this.sha=function(b,c,a){var d;if(b=="sha1"){d=sjcl.hash.sha1.hash(c)}else{if(b=="sha256"){d=sjcl.hash.sha256.hash(c)}else{if(b=="sha512"){d=sjcl.hash.sha512.hash(c)}else{}}}if(a=="hex"){d=sjcl.codec.hex.fromBits(d);return d}else{if(a=="base64"){d=sjcl.codec.base64.fromBits(d);return d}else{if(a=="none"){return d}else{return null}}}}}cipherJS.hash=new cipher_js_hash();function cipher_js_sym(){this.aesMode="ocb2";this.aesIter=1000;this.aesKeysize=256;this.aesAuthStrength=128;this.rijndaelKeysize=256;this.rijndaelIter=1000;this.twofishKeysize=256;this.twofishIter=1000;this.serpentKeysize=256;this.serpentIter=1000;this.encrypt=function(d,c,b){var a;b=b.toLowerCase();if(b=="aes"){a=cipherJS.sym.aesEncrypt(d,c)}else{if(b=="rijndael"){a=cipherJS.sym.rijndaelEncrypt(d,c)}else{if(b=="twofish"){a=cipherJS.sym.twofishEncrypt(d,c)}else{if(b=="serpent"){a=cipherJS.sym.serpentEncrypt(d,c)}else{if(b=="aes-twofish"){a=cipherJS.sym.aesTwofishEncrypt(d,c)}else{}}}}}return a};this.decrypt=function(c,b){var a=(JSON.parse(c)).cipher;var d;if(a=="aes"){d=cipherJS.sym.aesDecrypt(c,b)}else{if(a=="rijndael"){d=cipherJS.sym.rijndaelDecrypt(c,b)}else{if(a=="twofish"){d=cipherJS.sym.twofishDecrypt(c,b)}else{if(a=="serpent"){d=cipherJS.sym.serpentDecrypt(c,b)}else{if(a=="aes-twofish"){d=cipherJS.sym.aesTwofishDecrypt(c,b)}else{}}}}}return d};this.encryptAsync=function(a,j,f,k,e){a=a.chunk(3000);var g=new Array();var d=a.length;var b=0;var h={callback:k,outercarrier:e,algorithm:f,i:b,len:d,res:g,data:a,pass:j};setTimeout(function(){cipherJS.sym.encryptAsyncLoop1(h)},2)};this.encryptAsyncLoop1=function(j){var g=j.algorithm;var k=j.pass;var b=j.data;var e=j.len;var d=j.i;var h=j.res;var a=cipherJS.sym.encrypt(b[d],k,g);h.push(encodeURIComponent(a));j.res=h;j.i=j.i+1;if(j.i<e){setTimeout(function(){cipherJS.sym.encryptAsyncLoop1(j)},2)}else{var l=j.callback;var f=j.outercarrier;setTimeout(function(){l(JSON.stringify(h),f)},2)}};this.decryptAsync=function(g,e,j,f){g=JSON.parse(g);var a=g.length;var d=0;var b="";var h={callback:j,outercarrier:f,data:g,pass:e,len:a,i:d,res:b};setTimeout(function(){cipherJS.sym.decryptAsyncLoop1(h)},2)};this.decryptAsyncLoop1=function(j){var f=j.len;var e=j.i;var h=j.res;var d=j.data;var k=j.pass;var a=decodeURIComponent(d[e]);var b=cipherJS.sym.decrypt(a,k);h=h+b;j.res=h;j.i=j.i+1;if(j.i<f){setTimeout(function(){cipherJS.sym.decryptAsyncLoop1(j)},2)}else{var l=j.callback;var g=j.outercarrier;setTimeout(function(){l(h,g)},2)}};this.aesEncrypt=function(c,b){var a=sjcl.encrypt(b,c,{ks:cipherJS.sym.aesKeysize,ts:cipherJS.sym.aesAuthStrength,iter:cipherJS.sym.aesIter,mode:cipherJS.sym.aesMode});var d=sjcl.decrypt(b,a);if(d!=c){a=sjcl.encrypt(b,c,{ks:cipherJS.sym.aesKeysize,ts:cipherJS.sym.aesAuthStrength,iter:cipherJS.sym.aesIter,mode:cipherJS.sym.aesMode});d=sjcl.decrypt(b,a);if(d!=c){a=sjcl.encrypt(b,c,{ks:cipherJS.sym.aesKeysize,ts:cipherJS.sym.aesAuthStrength,iter:cipherJS.sym.aesIter,mode:cipherJS.sym.aesMode});d=sjcl.decrypt(b,a);if(d!=c){throw new cipherJS.sym.decryptError("Error while encrypting: Bug or browser incompatibility or invalid input.")}}}return a};this.aesDecrypt=function(d,b){var g;try{g=sjcl.decrypt(b,d)}catch(f){try{g=sjcl.decrypt(b,d)}catch(e){try{g=sjcl.decrypt(b,d)}catch(c){try{g=sjcl.decrypt(b,d)}catch(a){throw new cipherJS.sym.decryptError("Error while decrypting (Algorithm: AES). Suspected reason: Wrong password.")}}}}if(g.length<d.length){try{g=sjcl.decrypt(b,d)}catch(f){try{g=sjcl.decrypt(b,d)}catch(e){try{g=sjcl.decrypt(b,d)}catch(c){g=sjcl.decrypt(b,d)}}}}return g};this.rijndaelEncrypt=function(q,b){var p=cipherJS.sym.rijndaelKeysize;var k=cipherJS.sym.rijndaelIter;var m=sjcl.misc.cachedPbkdf2(b,{iter:k});var r=m.key.slice(0,p/32);var d=m.salt;var a=sjcl.codec.base64.fromBits(r);var g=sjcl.codec.hex.fromBits(d);var l=cipherJS.sym.titaniumcoreAlgorithm.RIJNDAEL;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="ENCRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var e=str2utf8(q);r=base64_decode(cipherJS.sym.pack(a));var o=c.execute(r.concat(),e.concat());var f=cipherJS.sym.stringBreak(base64_encode(o),48);var j=cipherJS.sym.signHMAC(a,f);f={cipher:"rijndael",salt:g,iter:k,ks:p,ct:f,signature:j};f=JSON.stringify(f);return f};this.rijndaelDecrypt=function(q,b){q=JSON.parse(q);var g=q.salt;var d=sjcl.codec.hex.toBits(g);var k=q.iter;var p=q.ks;var o=q.ct;var m=sjcl.misc.cachedPbkdf2(b,{iter:k,salt:d});var r=m.key.slice(0,p/32);var a=sjcl.codec.base64.fromBits(r);var l=cipherJS.sym.titaniumcoreAlgorithm.RIJNDAEL;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="DECRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var j=cipherJS.sym.signHMAC(a,o);if(j!=q.signature){throw new cipherJS.sym.decryptError("Error while decrypting (Algorithm: Rijndael). Suspected reason: Wrong password.")}o=base64_decode(cipherJS.sym.pack(o));r=base64_decode(cipherJS.sym.pack(a));var e=c.execute(r.concat(),o.concat());var f=utf82str(e);return f};this.twofishEncrypt=function(q,b){var p=cipherJS.sym.twofishKeysize;var k=cipherJS.sym.twofishIter;var m=sjcl.misc.cachedPbkdf2(b,{iter:k});var r=m.key.slice(0,p/32);var d=m.salt;var a=sjcl.codec.base64.fromBits(r);var g=sjcl.codec.hex.fromBits(d);var l=cipherJS.sym.titaniumcoreAlgorithm.TWOFISH;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="ENCRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var e=str2utf8(q);r=base64_decode(cipherJS.sym.pack(a));var o=c.execute(r.concat(),e.concat());var f=cipherJS.sym.stringBreak(base64_encode(o),48);var j=cipherJS.sym.signHMAC(a,f);f={cipher:"twofish",salt:g,iter:k,ks:p,ct:f,signature:j};f=JSON.stringify(f);return f};this.twofishDecrypt=function(q,b){q=JSON.parse(q);var g=q.salt;var d=sjcl.codec.hex.toBits(g);var k=q.iter;var p=q.ks;var o=q.ct;var m=sjcl.misc.cachedPbkdf2(b,{iter:k,salt:d});var r=m.key.slice(0,p/32);var a=sjcl.codec.base64.fromBits(r);var l=cipherJS.sym.titaniumcoreAlgorithm.TWOFISH;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="DECRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var j=cipherJS.sym.signHMAC(a,o);if(j!=q.signature){throw new cipherJS.sym.decryptError("Error while decrypting (Algorithm: Twofish). Suspected reason: Wrong password.")}o=base64_decode(cipherJS.sym.pack(o));r=base64_decode(cipherJS.sym.pack(a));var e=c.execute(r.concat(),o.concat());var f=utf82str(e);return f};this.serpentEncrypt=function(q,b){var p=cipherJS.sym.serpentKeysize;var k=cipherJS.sym.serpentIter;var m=sjcl.misc.cachedPbkdf2(b,{iter:k});var r=m.key.slice(0,p/32);var d=m.salt;var a=sjcl.codec.base64.fromBits(r);var g=sjcl.codec.hex.fromBits(d);var l=cipherJS.sym.titaniumcoreAlgorithm.SERPENT;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="ENCRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var e=str2utf8(q);r=base64_decode(cipherJS.sym.pack(a));var o=c.execute(r.concat(),e.concat());var f=cipherJS.sym.stringBreak(base64_encode(o),48);var j=cipherJS.sym.signHMAC(a,f);f={cipher:"serpent",salt:g,iter:k,ks:p,ct:f,signature:j};f=JSON.stringify(f);return f};this.serpentDecrypt=function(q,b){q=JSON.parse(q);var g=q.salt;var d=sjcl.codec.hex.toBits(g);var k=q.iter;var p=q.ks;var o=q.ct;var m=sjcl.misc.cachedPbkdf2(b,{iter:k,salt:d});var r=m.key.slice(0,p/32);var a=sjcl.codec.base64.fromBits(r);var l=cipherJS.sym.titaniumcoreAlgorithm.SERPENT;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="DECRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var j=cipherJS.sym.signHMAC(a,o);if(j!=q.signature){throw new cipherJS.sym.decryptError("Error while decrypting (Algorithm: Serpent). Suspected reason: Wrong password.")}o=base64_decode(cipherJS.sym.pack(o));r=base64_decode(cipherJS.sym.pack(a));var e=c.execute(r.concat(),o.concat());var f=utf82str(e);return f};this.aesTwofishEncrypt=function(e,d){var c=sjcl.hash.sha512.hash(d);var a=sjcl.hash.sha512.hash(c);c=sjcl.codec.base64.fromBits(c);a=sjcl.codec.base64.fromBits(a);var b=cipherJS.sym.twofishEncrypt(e,c);b=encodeURIComponent(b);b=cipherJS.sym.aesEncrypt(b,a);b=encodeURIComponent(b);b={cipher:"aes-twofish",ct:b};b=JSON.stringify(b);return b};this.aesTwofishDecrypt=function(d,c){d=JSON.parse(d);d=d.ct;d=decodeURIComponent(d);var b=sjcl.hash.sha512.hash(c);var a=sjcl.hash.sha512.hash(b);b=sjcl.codec.base64.fromBits(b);a=sjcl.codec.base64.fromBits(a);var e=cipherJS.sym.aesDecrypt(d,a);e=decodeURIComponent(e);e=cipherJS.sym.twofishDecrypt(e,b);return e};this.titaniumcoreCipher=__import(window,"titaniumcore.crypto.Cipher");this.titaniumcoreAlgorithm={SERPENT:"SERPENT",TWOFISH:"TWOFISH",RIJNDAEL:"RIJNDAEL"};this.titaniumcoreBlockmode={ECB:"ECB",CBC:"CBC"};this.titaniumcorePaddings={PKCS7:"PKCS7",RFC1321:"RFC1321",ANSIX923:"ANSIX923",ISO10126:"ISO10126",NO_PADDING:"NO_PADDING"};this.titaniumcoreCreateCipher=function(b,f,e,d){var c=cipherJS.sym.titaniumcoreCipher;b=c[b];f=c[f];e=c[e];d=c[d];var a=c.create(b,d,f,e);return a};this.stringBreak=function(d,b){var a="";for(var c=0;c<d.length;c++){a+=d.charAt(c);if(((c+1)%b==0)&&(0<c)){a+="\n"}}return a};this.pack=function(d){var a="";for(var b=0;b<d.length;b++){var e=d.charAt(b);if(e==" "||e=="\t"||e=="\r"||e=="\n"){}else{a+=e}}return a};this.signHMAC=function(c,e){var b=cipherJS.hash.sha512(c,"hex");b=cipherJS.hash.sha256(b,"none");e=cipherJS.hash.sha256(e,"hex");var d=new sjcl.misc.hmac(b,sjcl.hash.sha256);var a=d.encrypt(e);a=sjcl.codec.base64.fromBits(a);return a};this.decryptError=function(a){this.name="Symmetric Decryption Error";this.message=a||"Error while decryption. Suspected reason: Wrong password."}}cipherJS.sym=new cipher_js_sym();cipherJS.sym.decryptError.prototype=Error.prototype;function cipherjs_asym(){this.symmetricAlgorithm="aes-twofish";this.asyncTimeout=10;this.generateKeys=function(c,a,d,b){ecHandler.keys.generateKeypairAsync(c,function(f,g){f.priv=cipherJS.asym.symEncrypt(f.priv,g.pass);g.keys_enc=f;var e=function(){ecHandler.keys.generateKeypairAsync(g.curve,function(k,o){k.priv=cipherJS.asym.symEncrypt(k.priv,o.pass);var j=o.keys_enc;var l=k;var n=cipherJS.hash.sha256((j.pub+l.pub),"hex");var h={id:n,encryption:j,signing:l};var i={id:n,encryption:{pub:j.pub},signing:{pub:l.pub}};var m=function(){o.callback(h,i,o.outercarrier)};setTimeout(m,cipherJS.asym.asyncTimeout)},g)};setTimeout(e,cipherJS.asym.asyncTimeout)},{callback:d,outercarrier:b,curve:c,pass:a})};this.encryptString=function(e,j,g,d,a){var c=e.length;var b=0;var f="";if(typeof a=="string"||typeof a=="String"){f=a}else{f=cipherJS.asym.randomKeyString()}var h=new Array();d={callback:g,outercarrier:d,cleartext:j,pks:e,len:c,i:b,randkey:f,eks:h};setTimeout(function(){cipherJS.asym.encryptStringLoop(d)},cipherJS.asym.asyncTimeout)};this.encryptStringLoop=function(c){if(c.i<c.len){var a=c.pks[c.i];var b=a.encryption.pub;ecHandler.elgamal.kemAsync(b,function(i,h){var g=sjcl.codec.hex.fromBits(i.key);var d=i.tag;var f=cipherJS.asym.symEncrypt(h.randkey,g);var e=cipherJS.asym.hashPublicKey(h.pks[h.i].encryption.pub);f={enckey:f,keytag:d,keyhash:e};h.eks.push(f);h.i+=1;setTimeout(function(){cipherJS.asym.encryptStringLoop(h)},cipherJS.asym.asyncTimeout)},c)}else{cipherJS.asym.symEncryptAsync(c.cleartext,c.randkey,function(e,d){var g={enckeys:d.eks,ciphertext:e};var f=function(){d.callback(g,d.outercarrier)};setTimeout(f,cipherJS.asym.asyncTimeout)},c)}};this.decryptString=function(b,a,m,o,k){try{a.encryption.priv=cipherJS.asym.symDecrypt(a.encryption.priv,m)}catch(j){o(null,k)}var l=b.enckeys;var d=0;var h=l.length;var p=false;var n=cipherJS.asym.hashPublicKey(a.encryption.pub);var g="";var f="";for(d=0;d<h;d++){var c=l[d].keyhash;if(n==c){g=l[d].keytag;f=l[d].enckey;p=true;break}}if(p){var k={callback:o,outercarrier:k,msg:b,enckey:f,keyhash:n};ecHandler.elgamal.unkemAsync(a.encryption.priv,g,function(i,q){i=sjcl.codec.hex.fromBits(i);var e=cipherJS.asym.symDecrypt(q.enckey,i);cipherJS.asym.symDecryptAsync(b.ciphertext,e,function(r,s){var t=function(){s.callback(r,s.outercarrier)};setTimeout(t,cipherJS.asym.asyncTimeout)},q)},k)}else{o(null,k)}};this.signString=function(c,b,a,h,d){try{c.signing.priv=cipherJS.asym.symDecrypt(c.signing.priv,b)}catch(g){h(null,d)}d={callback:h,outercarrier:d,cleartext:a};var f=cipherJS.asym.hashMessage(a);ecHandler.ecdsa.signAsync(f,c.signing.priv,function(j,e){j=sjcl.codec.base64.fromBits(j);var i=function(){e.callback({cleartext:e.cleartext,signature:j},e.outercarrier)};setTimeout(i,cipherJS.asym.asyncTimeout)},d)};this.verifySignature=function(c,b,a,f,d){d={callback:f,outercarrier:d};var e=cipherJS.asym.hashMessage(b);a=sjcl.codec.base64.toBits(a);ecHandler.ecdsa.verifyAsync(e,a,c.signing.pub,function(g,h){var i=function(){h.callback(g,h.outercarrier)};setTimeout(i,cipherJS.asym.asyncTimeout)},d)};this.encryptAndSignString=function(g,d,c,b,f,e,a){e={callback:f,outercarrier:e,cleartext:b,recv_keysets:g};e.symkey=a;cipherJS.asym.signString(d,c,b,function(h,i){i.signature=h.signature;cipherJS.asym.encryptString(i.recv_keysets,i.cleartext,function(j,k){j.signature=k.signature;var l=function(){k.callback(j,k.outercarrier)};setTimeout(l,cipherJS.asym.asyncTimeout)},i,i.symkey)},e)};this.decryptAndVerify=function(a,e,c,b,f,d){d={callback:f,outercarrier:d,sender_keyset:b,signature:a.signature};cipherJS.asym.decryptString(a,e,c,function(g,h){if(g!==null){h.cleartext=g;cipherJS.asym.verifySignature(h.sender_keyset,g,h.signature,function(j,k){var l=function(){k.callback({cleartext:k.cleartext,verified:j},k.outercarrier)};setTimeout(l,cipherJS.asym.asyncTimeout)},h)}else{var i=function(){h.callback(null,h.outercarrier)};setTimeout(i,cipherJS.asym.asyncTimeout)}},d)};this.symEncryptAsync=function(d,b,e,c){var a=cipherJS.asym.symmetricAlgorithm;cipherJS.sym.encryptAsync(d,b,a,function(f,g){e(f,g)},c)};this.symDecryptAsync=function(c,a,d,b){cipherJS.sym.decryptAsync(c,a,function(f,e){d(f,e)},b)};this.symEncrypt=function(d,c){var b=cipherJS.asym.symmetricAlgorithm;var a=cipherJS.sym.encrypt(d,c,b);return a};this.symDecrypt=function(b,a){var c=cipherJS.sym.decrypt(b,a);return c};this.hashPublicKey=function(a){var c=sjcl.hash.sha1.hash(a);c=sjcl.codec.hex.fromBits(c);var b=sjcl.hash.sha1.hash(a);b=sjcl.codec.hex.fromBits(b);if(c==b){return c}else{c=sjcl.hash.sha1.hash(a);c=sjcl.codec.hex.fromBits(c);b=sjcl.hash.sha1.hash(a);b=sjcl.codec.hex.fromBits(b);return c}};this.hashMessage=function(b){var a;a=sjcl.hash.sha512.hash(b);a=sjcl.hash.sha256.hash(b);return a};this.randomKeyString=function(b,c){if(b===undefined||b=="undefined"){b=64}var g="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";if(c=="hex"){g="012345678abcdef"}var f=b;var a="";for(var d=f;d>0;--d){var e=sjcl.random.randomWords(1,10);e=e[0];if(e<0){e=e*(-1)}e="0."+e;e=parseFloat(e);a+=g[Math.round(e*(g.length-1))]}return a}}cipherJS.asym=new cipherjs_asym();function cipherjs_asym_simple(){this.version="0.0.2";this.generateKeyset=function(c,a,d,b){b={callback:d,outercarrier:b};cipherJS.asym.generateKeys(c,a,function(e,f,g){e=cipherJS.asym.simple.stringifyKeyset(e);f=cipherJS.asym.simple.stringifyKeyset(f);var h=function(){g.callback(e,f,g.outercarrier)};setTimeout(h,cipherJS.asym.asyncTimeout)},b)};this.encryptMessage=function(g,d,f,e,c){e={callback:f,outercarrier:e};var a=g.length;for(var b=0;b<a;b++){g[b]=cipherJS.asym.simple.parseKeyset(g[b])}cipherJS.asym.encryptString(g,d,function(j,h){j=cipherJS.asym.simple.stringifyMessage(j);var i=function(){h.callback(j,h.outercarrier)};setTimeout(i,cipherJS.asym.asyncTimeout)},e,c)};this.decryptMessage=function(d,c,a,e,b){b={callback:e,outercarrier:b};d=cipherJS.asym.simple.parseMessage(d);c=cipherJS.asym.simple.parseKeyset(c);cipherJS.asym.decryptString(d,c,a,function(f,g){var h=function(){g.callback(f,g.outercarrier)};setTimeout(h,cipherJS.asym.asyncTimeout)},b)};this.signMessage=function(c,b,a,e,d){d={callback:e,outercarrier:d};c=cipherJS.asym.simple.parseKeyset(c);cipherJS.asym.signString(c,b,a,function(f,g){f=cipherJS.asym.simple.stringifyMessage(f);var h=function(){g.callback(f,g.outercarrier)};setTimeout(h,cipherJS.asym.asyncTimeout)},d)};this.verifyMessage=function(a,c,d,b){b={callback:d,outercarrier:b};a=cipherJS.asym.simple.parseKeyset(a);c=cipherJS.asym.simple.parseMessage(c);cipherJS.asym.verifySignature(a,c.cleartext,c.signature,function(e,f){var g=function(){f.callback(e,f.outercarrier)};setTimeout(g,cipherJS.asym.asyncTimeout)},b)};this.encryptAndSignMessage=function(b,f,g,j,h,e,a){e={callback:h,outercarrier:e};var d=b.length;for(var c=0;c<d;c++){b[c]=cipherJS.asym.simple.parseKeyset(b[c])}f=cipherJS.asym.simple.parseKeyset(f);cipherJS.asym.encryptAndSignString(b,f,g,j,function(i,k){i=cipherJS.asym.simple.stringifyMessage(i);var l=function(){k.callback(i,k.outercarrier)};setTimeout(l,cipherJS.asym.asyncTimeout)},e,a)};this.decryptAndVerifyMessage=function(e,d,b,a,f,c){c={callback:f,outercarrier:c};e=cipherJS.asym.simple.parseMessage(e);d=cipherJS.asym.simple.parseKeyset(d);a=cipherJS.asym.simple.parseKeyset(a);cipherJS.asym.decryptAndVerify(e,d,b,a,function(i,g){var h=function(){g.callback(i,g.outercarrier)};setTimeout(h,cipherJS.asym.asyncTimeout)},c)};this.printId=function(b){var a=b.between("<id>","</id>");var c=(b.between("<encryption>","</encryption>")).between("<pub>","</pub>");var e=(b.between("<signing>","</signing>")).between("<pub>","</pub>");var d=cipherJS.hash.sha256((c+e),"hex");if(d!==a){d=cipherJS.hash.sha256((c+e),"hex");if(d!==a){d=cipherJS.hash.sha256((c+e),"hex");if(d!==a){return null}}}return d};this.stringifyMessage=function(d){var b="<message><version>"+cipherJS.asym.simple.version+"</version>";var a=(typeof d.signature!="undefined"&&typeof d.cleartext!="undefined");var e=(typeof d.ciphertext!="undefined"&&typeof d.signature=="undefined");var c=(typeof d.ciphertext!="undefined"&&typeof d.signature!="undefined");if(a){b+="<type>signed</type>";b+="<content>"+d.cleartext+"</content>";b+="<signature>"+d.signature+"</signature>"}else{if(e){b+="<type>encrypted</type>";b+=cipherJS.asym.simple.stringifyEnckeys(d.enckeys);b+="<content>"+d.ciphertext+"</content>"}else{if(c){b+="<type>encrypted,signed</type>";b+=cipherJS.asym.simple.stringifyEnckeys(d.enckeys);b+="<content>"+d.ciphertext+"</content>";b+="<signature>"+d.signature+"</signature>"}else{}}}b+="</message>";return b};this.parseMessage=function(g){var d=new Object();var b=g.between("<type>","</type>");if(b=="signed"){var c=g.between("<content>","</content>");var a=g.between("<signature>","</signature>");d.cleartext=c;d.signature=a}else{if(b=="encrypted"){var e=g.between("<content>","</content>");var f=cipherJS.asym.simple.parseEnckeys(g.between("<enckeys>","</enckeys>"));d.ciphertext=e;d.enckeys=f}else{if(b=="encrypted,signed"){var e=g.between("<content>","</content>");var f=cipherJS.asym.simple.parseEnckeys(g.between("<enckeys>","</enckeys>"));d.ciphertext=e;d.enckeys=f;var a=g.between("<signature>","</signature>");d.signature=a}else{}}}return d};this.stringifyKeyset=function(e){var i=(typeof e.encryption.priv=="undefined");if(i){var b=e.encryption.pub;var g=e.signing.pub;var d=e.id;var a=cipherJS.hash.sha256((b+g),"hex");if(d!==a){a=cipherJS.hash.sha256((b+g),"hex");if(d!==a){a=cipherJS.hash.sha256((b+g),"hex");if(d!==a){return null}}}var c="<keyset><version>"+cipherJS.asym.simple.version+"</version><type>public</type><id>"+a+"</id><encryption><pub>"+b+"</pub></encryption><signing><pub>"+g+"</pub></signing></keyset>";return c}else{var b=e.encryption.pub;var f=e.encryption.priv;var g=e.signing.pub;var h=e.signing.priv;var d=e.id;var a=cipherJS.hash.sha256((b+g),"hex");if(d!==a){a=cipherJS.hash.sha256((b+g),"hex");if(d!==a){a=cipherJS.hash.sha256((b+g),"hex");if(d!==a){return null}}}var c="<keyset><version>"+cipherJS.asym.simple.version+"</version><type>full</type><id>"+a+"</id><encryption><pub>"+b+"</pub><priv>"+f+"</priv></encryption><signing><pub>"+g+"</pub><priv>"+h+"</priv></signing></keyset>";return c}};this.parseKeyset=function(h){var g=h.between("<type>","</type>").trim();var e=h.between("<id>","</id>").trim();if(g=="full"){var f=h.between("<encryption>","</encryption>");var a=h.between("<signing>","</signing>");var c=f.between("<pub>","</pub>");var i=f.between("<priv>","</priv>");var j=a.between("<pub>","</pub>");var k=a.between("<priv>","</priv>");var b=cipherJS.hash.sha256((c+j),"hex");if(e!==b){b=cipherJS.hash.sha256((c+j),"hex");if(e!==b){b=cipherJS.hash.sha256((c+j),"hex");if(e!==b){return null}}}var d={id:b,encryption:{pub:c,priv:i},signing:{pub:j,priv:k}};return d}else{var f=h.between("<encryption>","</encryption>");var a=h.between("<signing>","</signing>");var c=f.between("<pub>","</pub>");var j=a.between("<pub>","</pub>");var b=cipherJS.hash.sha256((c+j),"hex");if(e!==b){b=cipherJS.hash.sha256((c+j),"hex");if(e!==b){b=cipherJS.hash.sha256((c+j),"hex");if(e!==b){return null}}}var d={id:b,encryption:{pub:c},signing:{pub:j}};return d}};this.stringifyEnckeys=function(a){var c=a.length;var e="<enckeys>";for(var b=0;b<c;b++){var d=a[b];e+='<enckey id="'+b+">";e+="<keyhash>"+d.keyhash+"</keyhash>";e+="<keytag>"+d.keytag+"</keytag>";e+="<enckeystr>"+d.enckey+"</enckeystr>";e+="</enckey>"}e+="</enckeys>";return e};this.parseEnckeys=function(g){var f=new Array();var c=0;var h=g.between(('<enckey id="'+c+">"),"</enckey>");while(typeof h=="string"||typeof h=="String"){var a=h.between("<keyhash>","</keyhash>");var e=h.between("<keytag>","</keytag>");var b=h.between("<enckeystr>","</enckeystr>");var d={keyhash:a,keytag:e,enckey:b};f.push(d);c+=1;h=g.between(('<enckey id="'+c+">"),"</enckey>")}return f}}cipherJS.asym.simple=new cipherjs_asym_simple();