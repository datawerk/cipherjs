String.prototype.replaceAll=function(c,a){var b=this;return b.replace(new RegExp(c,"g"),a)};String.prototype.startsWith=function(a){return this.indexOf(a)==0};String.prototype.trim=function(){var c=this.replace(/^\s\s*/,""),a=/\s/,b=c.length;while(a.test(c.charAt(--b))){}c=c.slice(0,b+1);c=c.replace(/^\s+|\s+$/g,"");return c};String.prototype.allTrim=function(){var a=this.replace(/\s+/g," ");a=a.replace(/^\s+|\s+$/,"");a=a.replace(/^\s+|\s+$/g,"");return a};String.prototype.removeWhitespace=function(){return this.replace(/\s+/g,"")};String.prototype.removeLinebreaks=function(){return this.replace(/(\r\n|\n|\r)/gm,"")};String.prototype.removeWhitespaceAndLinebreaks=function(){var a=this.replace(/\s+/g," ");a=a.replace(/(\r\n|\n|\r)/gm,"");return a};String.prototype.between=function(f,a){var e=this.indexOf(f);var d=this.substr(e);var c=d.indexOf(a);c=e+c;if(e!=-1&&c!=-1){e=e+f.length;var b=this.length-(this.length-c)-e;return this.substr(e,b)}return null};String.prototype.chunk=function(d){var h=this;var a=0;var b=d;var j=h.length/d;var g=Math.ceil(j);var f=new Array();for(var c=0;c<g;c++){var e=h.slice(a,b);f.push(e);a=a+d;b=b+d}return f};if(typeof crypto.getRandomValues=="function"){Math.random=function(){var c=new Uint32Array(1);crypto.getRandomValues(c);var b=c[0];var a="0."+b;a=parseFloat(a);return a}}var cipherJS=new Object();cipherJS.init=new Object();cipherJS.init.entropyId=null;cipherJS.init.entropyInfoId=null;cipherJS.init.doneDOMObj=null;cipherJS.init.doneInfoDOMObj=null;cipherJS.init.init=function(d,a,b,c){windowonerrorBackup=window.onerror;window.onerror=function(){return true};cipherJS.init.entropyId=d;cipherJS.init.doneDOMObj=a;if(b!="undefined"){cipherJS.init.entropyInfoId=b}if(c!="undefined"){cipherJS.init.doneInfoDOMObj=c}document.addEventListener("touchmove",cipherJS.init.touchMoveMapper,true);document.addEventListener("mousemove",cipherJS.init.update,true);sjcl.random.startCollectors();window.setTimeout(cipherJS.init.update,0)};cipherJS.init.update=function(){var d=document.getElementById(cipherJS.init.entropyId);var e=cipherJS.init.doneDOMObj;var a=sjcl.random.getProgress(10);if(a===undefined||a==1){d.innerHTML="";d.appendChild(cipherJS.init.doneDOMObj);if(cipherJS.init.entropyInfoId!=null){var b=document.getElementById(cipherJS.init.entropyInfoId);b.innerHTML="";b.appendChild(cipherJS.init.doneInfoDOMObj)}sjcl.random.stopCollectors();document.removeEventListener("touchmove",cipherJS.init.touchMoveMapper);document.removeEventListener("mousemove",cipherJS.init.update);window.onerror=windowonerrorBackup}else{var c=Math.round((a.toFixed(2)*100));c=c+"%";d.innerHTML=c}};cipherJS.init.touchMoveMapper=function(c){var d=c.changedTouches,e=d[0],a="";switch(c.type){case"touchmove":a="mousemove";break;default:return}var b=document.createEvent("MouseEvent");b.initMouseEvent(a,true,true,window,1,e.screenX,e.screenY,e.clientX,e.clientY,false,false,false,false,0,null);e.target.dispatchEvent(b);c.preventDefault()};function cipher_js_encoding(){this.toHex=function(e,a){var c=function(k,h){h=h.toLowerCase();var j;var i;if(h=="base64"){j=sjcl.codec.base64.toBits(k);i=sjcl.codec.hex.fromBits(j);return i}else{if(h=="utf8"){j=sjcl.codec.utf8String.toBits(k);i=sjcl.codec.hex.fromBits(j);return i}else{return null}}};var b;try{b=c(e,a)}catch(g){try{b=c(e,a)}catch(f){try{b=c(e,a)}catch(d){b=c(e,a)}}}return b};this.toBase64=function(e,a){var c=function(k,h){h=h.toLowerCase();var j;var i;if(h=="hex"){j=sjcl.codec.hex.toBits(k);i=sjcl.codec.base64.fromBits(j);return i}else{if(h=="utf8"){j=sjcl.codec.utf8String.toBits(k);i=sjcl.codec.base64.fromBits(j);return i}else{return null}}};var b;try{b=c(e,a)}catch(g){try{b=c(e,a)}catch(f){try{b=c(e,a)}catch(d){b=c(e,a)}}}return b};this.toUtf8=function(e,a){var c=function(k,h){h=h.toLowerCase();var j;var i;if(h=="hex"){j=sjcl.codec.hex.toBits(k);i=sjcl.codec.utf8String.fromBits(j);return i}else{if(h=="base64"){j=sjcl.codec.base64.toBits(k);i=sjcl.codec.utf8String.fromBits(j);return i}else{return null}}};var b;try{b=c(e,a)}catch(g){try{b=c(e,a)}catch(f){try{b=c(e,a)}catch(d){b=c(e,a)}}}return b};this.toBits=function(e,a){var c=function(j,h){h=h.toLowerCase();var i;if(h=="hex"){i=sjcl.codec.hex.toBits(j);return i}else{if(h=="base64"){i=sjcl.codec.base64.toBits(j);return i}else{if(h=="utf8"){i=sjcl.codec.utf8String.toBits(j);return i}else{return null}}}};var b;try{b=c(e,a)}catch(g){try{b=c(e,a)}catch(f){try{b=c(e,a)}catch(d){b=c(e,a)}}}return b};this.fromBits=function(e,a){var c=function(i,h){h=h.toLowerCase();var j;if(h=="hex"){j=sjcl.codec.hex.fromBits(i);return j}else{if(h=="base64"){j=sjcl.codec.base64.fromBits(i);return j}else{if(h=="utf8"){j=sjcl.codec.utf8String.fromBits(i);return j}else{return null}}}};var b;try{b=c(e,a)}catch(g){try{b=c(e,a)}catch(f){try{b=c(e,a)}catch(d){b=c(e,a)}}}return b}}cipherJS.enc=new cipher_js_encoding();function cipher_js_mask(){this.mask=function(b){var a=cipherJS.enc.toBase64(b,"utf8");a=encodeURIComponent(a);return a};this.unmask=function(b){var a=decodeURIComponent(b);a=cipherJS.enc.toUtf8(a,"base64");return a}}cipherJS.mask=new cipher_js_mask();function cipher_js_random(){this.randomNumber=function(){var a=sjcl.random.randomWords(1,10);a=a[0];return a};this.mathRandom=function(){var a=sjcl.random.randomWords(1,10);a=a[0];if(a<0){a=a*(-1)}a="0."+a;a=parseFloat(a);return a};this.randomFloat=function(b,a){var c=sjcl.random.randomWords(1,10);c=c[0];if(c<0){c=c*(-1)}c="0."+c;c=parseFloat(c);c=c*(a-b)+b;return c};this.randomInteger=function(b,a){var c=sjcl.random.randomWords(1,10);c=c[0];if(c<0){c=c*(-1)}c="0."+c;c=parseFloat(c);c=c*(a-b)+b;c=Math.floor(c);return c};this.randomString=function(b,c){if(b===undefined||b=="undefined"){b=64}var g="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";if(typeof c!="undefined"){if(c=="hex"){g="012345678abcdef"}}var f=b;var a="";for(var d=f;d>0;--d){var e=sjcl.random.randomWords(1,10);e=e[0];if(e<0){e=e*(-1)}e="0."+e;e=parseFloat(e);a+=g[Math.round(e*(g.length-1))]}return a}}cipherJS.random=new cipher_js_random();function cipher_js_hash(){this.sha1=function(f,b){var d=function(k,i){var m;try{m=cipherJS.hash.sha("sha1",k,i)}catch(n){try{m=cipherJS.hash.sha("sha1",k,i)}catch(l){try{m=cipherJS.hash.sha("sha1",k,i)}catch(j){m=cipherJS.hash.sha("sha1",k,i)}}}return m};if(b!="none"){var h=d(f,b);var g=d(f,b);if(h==g){return h}else{h=d(f,b);g=d(f,b);if(h==g){return h}else{return null}}}else{var h=d(f,b);var g=d(f,b);var e=true;var a=h.length;var c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{h=d(f,b);g=d(f,b);e=true;a=h.length;c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{return null}}}};this.sha256=function(f,b){var d=function(k,i){var m;try{m=cipherJS.hash.sha("sha256",k,i)}catch(n){try{m=cipherJS.hash.sha("sha256",k,i)}catch(l){try{m=cipherJS.hash.sha("sha256",k,i)}catch(j){m=cipherJS.hash.sha("sha256",k,i)}}}return m};if(b!="none"){var h=d(f,b);var g=d(f,b);if(h==g){return h}else{h=d(f,b);g=d(f,b);if(h==g){return h}else{return null}}}else{var h=d(f,b);var g=d(f,b);var e=true;var a=h.length;var c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{h=d(f,b);g=d(f,b);e=true;a=h.length;c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{return null}}}};this.sha512=function(f,b){var d=function(k,i){var m;try{m=cipherJS.hash.sha("sha512",k,i)}catch(n){try{m=cipherJS.hash.sha("sha512",k,i)}catch(l){try{m=cipherJS.hash.sha("sha512",k,i)}catch(j){m=cipherJS.hash.sha("sha512",k,i)}}}return m};if(b!="none"){var h=d(f,b);var g=d(f,b);if(h==g){return h}else{h=d(f,b);g=d(f,b);if(h==g){return h}else{return null}}}else{var h=d(f,b);var g=d(f,b);var e=true;var a=h.length;var c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{h=d(f,b);g=d(f,b);e=true;a=h.length;c=0;for(c=0;c<a;c++){if(h[c]!==g[c]){e=false}}if(e){return h}else{return null}}}};this.sha=function(b,c,a){var d;if(b=="sha1"){d=sjcl.hash.sha1.hash(c)}else{if(b=="sha256"){d=sjcl.hash.sha256.hash(c)}else{if(b=="sha512"){d=sjcl.hash.sha512.hash(c)}else{}}}if(a=="hex"){d=sjcl.codec.hex.fromBits(d);return d}else{if(a=="base64"){d=sjcl.codec.base64.fromBits(d);return d}else{if(a=="none"){return d}else{return null}}}}}cipherJS.hash=new cipher_js_hash();function cipher_js_sym(){this.aesMode="ocb2";this.aesIter=1000;this.aesKeysize=256;this.aesAuthStrength=128;this.rijndaelKeysize=256;this.rijndaelIter=1000;this.twofishKeysize=256;this.twofishIter=1000;this.serpentKeysize=256;this.serpentIter=1000;this.encrypt=function(d,c,b){var a;b=b.toLowerCase();if(b=="aes"){a=cipherJS.sym.aesEncrypt(d,c)}else{if(b=="rijndael"){a=cipherJS.sym.rijndaelEncrypt(d,c)}else{if(b=="twofish"){a=cipherJS.sym.twofishEncrypt(d,c)}else{if(b=="serpent"){a=cipherJS.sym.serpentEncrypt(d,c)}else{if(b=="aes-twofish"){a=cipherJS.sym.aesTwofishEncrypt(d,c)}else{}}}}}return a};this.decrypt=function(c,b){var a=(JSON.parse(c)).cipher;var d;if(a=="aes"){d=cipherJS.sym.aesDecrypt(c,b)}else{if(a=="rijndael"){d=cipherJS.sym.rijndaelDecrypt(c,b)}else{if(a=="twofish"){d=cipherJS.sym.twofishDecrypt(c,b)}else{if(a=="serpent"){d=cipherJS.sym.serpentDecrypt(c,b)}else{if(a=="aes-twofish"){d=cipherJS.sym.aesTwofishDecrypt(c,b)}else{}}}}}return d};this.encryptAsync=function(a,j,f,k,e){a=a.chunk(3000);var g=new Array();var d=a.length;var b=0;var h={callback:k,outercarrier:e,algorithm:f,i:b,len:d,res:g,data:a,pass:j};setTimeout(function(){cipherJS.sym.encryptAsyncLoop1(h)},2)};this.encryptAsyncLoop1=function(j){var g=j.algorithm;var k=j.pass;var b=j.data;var e=j.len;var d=j.i;var h=j.res;var a=cipherJS.sym.encrypt(b[d],k,g);h.push(encodeURIComponent(a));j.res=h;j.i=j.i+1;if(j.i<e){setTimeout(function(){cipherJS.sym.encryptAsyncLoop1(j)},2)}else{var l=j.callback;var f=j.outercarrier;setTimeout(function(){l(JSON.stringify(h),f)},2)}};this.decryptAsync=function(g,e,j,f){g=JSON.parse(g);var a=g.length;var d=0;var b="";var h={callback:j,outercarrier:f,data:g,pass:e,len:a,i:d,res:b};setTimeout(function(){cipherJS.sym.decryptAsyncLoop1(h)},2)};this.decryptAsyncLoop1=function(j){var f=j.len;var e=j.i;var h=j.res;var d=j.data;var k=j.pass;var a=decodeURIComponent(d[e]);var b=cipherJS.sym.decrypt(a,k);h=h+b;j.res=h;j.i=j.i+1;if(j.i<f){setTimeout(function(){cipherJS.sym.decryptAsyncLoop1(j)},2)}else{var l=j.callback;var g=j.outercarrier;setTimeout(function(){l(h,g)},2)}};this.aesEncrypt=function(c,b){var a=sjcl.encrypt(b,c,{ks:cipherJS.sym.aesKeysize,ts:cipherJS.sym.aesAuthStrength,iter:cipherJS.sym.aesIter,mode:cipherJS.sym.aesMode});return a};this.aesDecrypt=function(d,b){var g;try{g=sjcl.decrypt(b,d)}catch(f){try{g=sjcl.decrypt(b,d)}catch(e){try{g=sjcl.decrypt(b,d)}catch(c){try{g=sjcl.decrypt(b,d)}catch(a){throw new cipherJS.sym.decryptError("Error while decrypting (Algorithm: AES). Suspected reason: Wrong password.")}}}}if(g.length<d.length){try{g=sjcl.decrypt(b,d)}catch(f){try{g=sjcl.decrypt(b,d)}catch(e){try{g=sjcl.decrypt(b,d)}catch(c){g=sjcl.decrypt(b,d)}}}}return g};this.rijndaelEncrypt=function(q,b){var p=cipherJS.sym.rijndaelKeysize;var k=cipherJS.sym.rijndaelIter;var m=sjcl.misc.cachedPbkdf2(b,{iter:k});var r=m.key.slice(0,p/32);var d=m.salt;var a=sjcl.codec.base64.fromBits(r);var g=sjcl.codec.hex.fromBits(d);var l=cipherJS.sym.titaniumcoreAlgorithm.RIJNDAEL;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="ENCRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var e=str2utf8(q);r=base64_decode(cipherJS.sym.pack(a));var o=c.execute(r.concat(),e.concat());var f=cipherJS.sym.stringBreak(base64_encode(o),48);var j=cipherJS.sym.signHMAC(a,f);f={cipher:"rijndael",salt:g,iter:k,ks:p,ct:f,signature:j};f=JSON.stringify(f);return f};this.rijndaelDecrypt=function(q,b){q=JSON.parse(q);var g=q.salt;var d=sjcl.codec.hex.toBits(g);var k=q.iter;var p=q.ks;var o=q.ct;var m=sjcl.misc.cachedPbkdf2(b,{iter:k,salt:d});var r=m.key.slice(0,p/32);var a=sjcl.codec.base64.fromBits(r);var l=cipherJS.sym.titaniumcoreAlgorithm.RIJNDAEL;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="DECRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var j=cipherJS.sym.signHMAC(a,o);if(j!=q.signature){throw new cipherJS.sym.decryptError("Error while decrypting (Algorithm: Rijndael). Suspected reason: Wrong password.")}o=base64_decode(cipherJS.sym.pack(o));r=base64_decode(cipherJS.sym.pack(a));var e=c.execute(r.concat(),o.concat());var f=utf82str(e);return f};this.twofishEncrypt=function(q,b){var p=cipherJS.sym.twofishKeysize;var k=cipherJS.sym.twofishIter;var m=sjcl.misc.cachedPbkdf2(b,{iter:k});var r=m.key.slice(0,p/32);var d=m.salt;var a=sjcl.codec.base64.fromBits(r);var g=sjcl.codec.hex.fromBits(d);var l=cipherJS.sym.titaniumcoreAlgorithm.TWOFISH;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="ENCRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var e=str2utf8(q);r=base64_decode(cipherJS.sym.pack(a));var o=c.execute(r.concat(),e.concat());var f=cipherJS.sym.stringBreak(base64_encode(o),48);var j=cipherJS.sym.signHMAC(a,f);f={cipher:"twofish",salt:g,iter:k,ks:p,ct:f,signature:j};f=JSON.stringify(f);return f};this.twofishDecrypt=function(q,b){q=JSON.parse(q);var g=q.salt;var d=sjcl.codec.hex.toBits(g);var k=q.iter;var p=q.ks;var o=q.ct;var m=sjcl.misc.cachedPbkdf2(b,{iter:k,salt:d});var r=m.key.slice(0,p/32);var a=sjcl.codec.base64.fromBits(r);var l=cipherJS.sym.titaniumcoreAlgorithm.TWOFISH;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="DECRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var j=cipherJS.sym.signHMAC(a,o);if(j!=q.signature){throw new cipherJS.sym.decryptError("Error while decrypting (Algorithm: Twofish). Suspected reason: Wrong password.")}o=base64_decode(cipherJS.sym.pack(o));r=base64_decode(cipherJS.sym.pack(a));var e=c.execute(r.concat(),o.concat());var f=utf82str(e);return f};this.serpentEncrypt=function(q,b){var p=cipherJS.sym.serpentKeysize;var k=cipherJS.sym.serpentIter;var m=sjcl.misc.cachedPbkdf2(b,{iter:k});var r=m.key.slice(0,p/32);var d=m.salt;var a=sjcl.codec.base64.fromBits(r);var g=sjcl.codec.hex.fromBits(d);var l=cipherJS.sym.titaniumcoreAlgorithm.SERPENT;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="ENCRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var e=str2utf8(q);r=base64_decode(cipherJS.sym.pack(a));var o=c.execute(r.concat(),e.concat());var f=cipherJS.sym.stringBreak(base64_encode(o),48);var j=cipherJS.sym.signHMAC(a,f);f={cipher:"serpent",salt:g,iter:k,ks:p,ct:f,signature:j};f=JSON.stringify(f);return f};this.serpentDecrypt=function(q,b){q=JSON.parse(q);var g=q.salt;var d=sjcl.codec.hex.toBits(g);var k=q.iter;var p=q.ks;var o=q.ct;var m=sjcl.misc.cachedPbkdf2(b,{iter:k,salt:d});var r=m.key.slice(0,p/32);var a=sjcl.codec.base64.fromBits(r);var l=cipherJS.sym.titaniumcoreAlgorithm.SERPENT;var h=cipherJS.sym.titaniumcoreBlockmode.CBC;var i=cipherJS.sym.titaniumcorePaddings.PKCS7;var n="DECRYPT";var c=cipherJS.sym.titaniumcoreCreateCipher(l,h,i,n);var j=cipherJS.sym.signHMAC(a,o);if(j!=q.signature){throw new cipherJS.sym.decryptError("Error while decrypting (Algorithm: Serpent). Suspected reason: Wrong password.")}o=base64_decode(cipherJS.sym.pack(o));r=base64_decode(cipherJS.sym.pack(a));var e=c.execute(r.concat(),o.concat());var f=utf82str(e);return f};this.aesTwofishEncrypt=function(e,d){var c=sjcl.hash.sha512.hash(d);var a=sjcl.hash.sha512.hash(c);c=sjcl.codec.base64.fromBits(c);a=sjcl.codec.base64.fromBits(a);var b=cipherJS.sym.twofishEncrypt(e,c);b=encodeURIComponent(b);b=cipherJS.sym.aesEncrypt(b,a);b=encodeURIComponent(b);b={cipher:"aes-twofish",ct:b};b=JSON.stringify(b);return b};this.aesTwofishDecrypt=function(d,c){d=JSON.parse(d);d=d.ct;d=decodeURIComponent(d);var b=sjcl.hash.sha512.hash(c);var a=sjcl.hash.sha512.hash(b);b=sjcl.codec.base64.fromBits(b);a=sjcl.codec.base64.fromBits(a);var e=cipherJS.sym.aesDecrypt(d,a);e=decodeURIComponent(e);e=cipherJS.sym.twofishDecrypt(e,b);return e};this.titaniumcoreCipher=__import(window,"titaniumcore.crypto.Cipher");this.titaniumcoreAlgorithm={SERPENT:"SERPENT",TWOFISH:"TWOFISH",RIJNDAEL:"RIJNDAEL"};this.titaniumcoreBlockmode={ECB:"ECB",CBC:"CBC"};this.titaniumcorePaddings={PKCS7:"PKCS7",RFC1321:"RFC1321",ANSIX923:"ANSIX923",ISO10126:"ISO10126",NO_PADDING:"NO_PADDING"};this.titaniumcoreCreateCipher=function(b,f,e,d){var c=cipherJS.sym.titaniumcoreCipher;b=c[b];f=c[f];e=c[e];d=c[d];var a=c.create(b,d,f,e);return a};this.stringBreak=function(d,b){var a="";for(var c=0;c<d.length;c++){a+=d.charAt(c);if(((c+1)%b==0)&&(0<c)){a+="\n"}}return a};this.pack=function(d){var a="";for(var b=0;b<d.length;b++){var e=d.charAt(b);if(e==" "||e=="\t"||e=="\r"||e=="\n"){}else{a+=e}}return a};this.signHMAC=function(c,e){var b=cipherJS.hash.sha512(c,"hex");b=cipherJS.hash.sha256(b,"none");e=cipherJS.hash.sha256(e,"hex");var d=new sjcl.misc.hmac(b,sjcl.hash.sha256);var a=d.encrypt(e);a=sjcl.codec.base64.fromBits(a);return a};this.decryptError=function(a){this.name="Symmetric Decryption Error";this.message=a||"Error while decryption. Suspected reason: Wrong password."}}cipherJS.sym=new cipher_js_sym();cipherJS.sym.decryptError.prototype=Error.prototype;function cipher_js_asym(){this.symmetricAlgorithm="aes-twofish";this.asyncTimeout=10;this.generateKeys=function(b,a,d,c){cipherJS.asym.generateKeysF(b,a,function(e,f){if(e==null){cipherJS.asym.generateKeysF(b,a,function(g,h){if(g==null){cipherJS.asym.generateKeysF(b,a,function(i,j){d(i,j)},h)}else{d(g,h)}},f)}else{d(e,f)}},c)};this.generateKeysF=function(c,a,e,d){var b={callback:e,outercarrier:d};b.bits=c;b.pass=a;if(c!=192&&c!=224&&c!=256&&c!=384&&c!=521){c=521}if(c==384){sjcl.ecc.elGamal.generateKeysAsync(192,10,function(f,g){sjcl.ecc.elGamal.generateKeysAsync(384,10,function(h,i){setTimeout(function(){cipherJS.asym.processElGamalKeys(h,i)},cipherJS.asym.asyncTimeout)},g)},b)}else{sjcl.ecc.elGamal.generateKeysAsync(c,10,function(f,g){setTimeout(function(){cipherJS.asym.processElGamalKeys(f,g)},cipherJS.asym.asyncTimeout)},b)}};this.processElGamalKeys=function(d,e){var b=cipherJS.asym.serializeSecretKey(d.sec,"elGamal");var c=cipherJS.asym.serializePublicKey(d.pub,"elGamal");var f=cipherJS.asym.checkKeypair(d.pub,b,"elGamal");if(!f){var a=e.callback;e=e.outercarrier;setTimeout(function(){a(null,e)},cipherJS.asym.asyncTimeout);return}e.pubElGamal=c;e.secElGamal=b;setTimeout(function(){cipherJS.asym.generateECDSAKeys(e)},cipherJS.asym.asyncTimeout)};this.generateECDSAKeys=function(b){var a=b.bits;if(a!=192&&a!=224&&a!=256&&a!=384&&a!=521){a=521}if(a==384){sjcl.ecc.ecdsa.generateKeysAsync(192,10,function(c,d){sjcl.ecc.ecdsa.generateKeysAsync(384,10,function(e,f){setTimeout(function(){cipherJS.asym.processECDSAKeys(e,f)},cipherJS.asym.asyncTimeout)},d)},b)}else{if(a==224){sjcl.ecc.ecdsa.generateKeysAsync(192,10,function(c,d){sjcl.ecc.ecdsa.generateKeysAsync(224,10,function(e,f){setTimeout(function(){cipherJS.asym.processECDSAKeys(e,f)},cipherJS.asym.asyncTimeout)},d)},b)}else{sjcl.ecc.ecdsa.generateKeysAsync(a,10,function(c,d){setTimeout(function(){cipherJS.asym.processECDSAKeys(c,d)},cipherJS.asym.asyncTimeout)},b)}}};this.processECDSAKeys=function(d,e){var b=cipherJS.asym.serializeSecretKey(d.sec,"ecdsa");var c=cipherJS.asym.serializePublicKey(d.pub,"ecdsa");var f=cipherJS.asym.checkKeypair(d.pub,b,"ecdsa");if(!f){var a=e.callback;e=e.outercarrier;setTimeout(function(){a(null,e)},cipherJS.asym.asyncTimeout);return}e.pubECDSA=c;e.secECDSA=b;setTimeout(function(){cipherJS.asym.processKeys(e)},cipherJS.asym.asyncTimeout)};this.processKeys=function(h){var g=h.pass;var d=h.pubElGamal;var b=cipherJS.asym.symEncrypt(h.secElGamal,g);var e=h.pubECDSA;var c=cipherJS.asym.symEncrypt(h.secECDSA,g);var f={encryption:{pub:d,sec:b},signing:{pub:e,sec:c}};var a=h.callback;h=h.outercarrier;setTimeout(function(){a(f,h)},cipherJS.asym.asyncTimeout)};this.encryptString=function(a,c,g,f,b){var e;if(typeof b!="undefined"){e=b}else{e=cipherJS.asym.randomKeyString(64)}var d={callback:g,outercarrier:f,randkey:e,pubkeys:a,i:0,pklen:a.length,enckeys:new Array()};cipherJS.asym.symEncryptAsync(c,e,function(h,j){var i=j;i.ciphertext=h;setTimeout(function(){cipherJS.asym.encryptStringLoop1(i)},cipherJS.asym.asyncTimeout)},d)};this.encryptStringLoop1=function(g){var c=g.pubkeys;var h=g.enckeys;var e=g.i;var a=g.pklen;var b=c[e];g.keyhash=cipherJS.asym.hashPublicKey(b);var d=JSON.parse(b);if(d.keytype!="elGamal"){return}var f=cipherJS.asym.deserializePublicKey(b,"elGamal");f.kemAsync(10,function(l,j){try{var i=f._curve.fromBits(l.tag);cipherJS.asym.encryptStringLoop2(l,j)}catch(k){f=cipherJS.asym.deserializePublicKey(b,"elGamal");f.kemAsync(10,function(p,n){try{var m=f._curve.fromBits(p.tag);cipherJS.asym.encryptStringLoop2(p,n)}catch(o){f=cipherJS.asym.deserializePublicKey(b,"elGamal");f.kemAsync(10,function(t,s){try{var q=f._curve.fromBits(t.tag);cipherJS.asym.encryptStringLoop2(t,s)}catch(r){cipherJS.asym.encryptStringLoop2(null,s)}},n)}},j)}},g)};this.encryptStringLoop2=function(n,j){if(n==null){setTimeout(function(){j.callback(null,j.outercarrier)},cipherJS.asym.asyncTimeout)}var o=j.enckeys;var e=j.i;var h=j.pklen;var l=j.keyhash;var g=n.tag;var a=n.key;g=sjcl.codec.hex.fromBits(g);a=sjcl.codec.hex.fromBits(a);var k=j.randkey;var m=cipherJS.asym.symEncrypt(k,a);var f={cipherkey:m,keyhash:l,keytag:g};o.push(f);j.enckeys=o;e=e+1;if(e<h){j.i=e;j.enckeys=o;setTimeout(function(){cipherJS.asym.encryptStringLoop1(j)},cipherJS.asym.asyncTimeout)}else{var c=j.callback;var b=j.ciphertext;j=j.outercarrier;var d={ciphertext:b,enckeys:o};setTimeout(function(){c(d,j)},cipherJS.asym.asyncTimeout)}};this.decryptString=function(b,d,h,k,c,i,j){try{d=cipherJS.asym.symDecrypt(d,h);JSON.parse(d)}catch(f){try{d=cipherJS.asym.symDecrypt(d,h);JSON.parse(d)}catch(f){try{d=cipherJS.asym.symDecrypt(d,h);JSON.parse(d)}catch(f){d=cipherJS.asym.symDecrypt(d,h)}}}var a=cipherJS.asym.decryptString2;var g={callback:a,cipherkey:k,ciphertext:b,outercallback:i,outercarrier:j};cipherJS.asym.decryptSymKeyAsync(c,d,g)};this.decryptSymKeyAsync=function(b,e,d){var a=sjcl.codec.hex.toBits(b);var c=cipherJS.asym.deserializeSecretKey(e,"elGamal");c.unkemAsync(a,function(f,g){g.callback(f,g)},d)};this.decryptString2=function(b,e){var a=e.cipherkey;var d=e.ciphertext;b=sjcl.codec.hex.fromBits(b);var c=cipherJS.asym.symDecrypt(a,b);cipherJS.asym.symDecryptAsync(d,c,function(h,g){var f=g.outercallback;setTimeout(function(){f({cleartext:h},g.outercarrier)},cipherJS.asym.asyncTimeout)},e)};this.signString=function(k,c,h,b,i,j){try{c=cipherJS.asym.symDecrypt(c,h);JSON.parse(c)}catch(g){try{c=cipherJS.asym.symDecrypt(c,h);JSON.parse(c)}catch(g){try{c=cipherJS.asym.symDecrypt(c,h);JSON.parse(c)}catch(g){c=cipherJS.asym.symDecrypt(c,h)}}}var d=cipherJS.asym.deserializeSecretKey(c,"ecdsa");var a=cipherJS.asym.hashMessage(k);var f={pubkey:b,callback:i,outercarrier:j,cleartext:k};d.signAsync(a,0,function(e,l){l.signature=sjcl.codec.hex.fromBits(e);cipherJS.asym.verifySignature(l.cleartext,l.signature,l.pubkey,function(n,q){if(n.verified=="verified"){var o=q.signature;var m=q.callback;var p=q.cleartext;m({message:p,signature:o},q.outercarrier)}else{d.signAsync(a,0,function(r,s){s.signature=sjcl.codec.hex.fromBits(r);cipherJS.asym.verifySignature(s.cleartext,s.signature,s.pubkey,function(u,x){if(u.verified=="verified"){var v=x.signature;var t=x.callback;var w=x.cleartext;t({message:w,signature:v},x.outercarrier)}else{d.signAsync(a,0,function(y,z){z.signature=sjcl.codec.hex.fromBits(y);cipherJS.asym.verifySignature(z.cleartext,z.signature,z.pubkey,function(B,E){if(B.verified=="verified"){var C=E.signature;var A=E.callback;var D=E.cleartext;A({message:D,signature:C},E.outercarrier)}else{var C=null;var A=E.callback;var D=E.cleartext;A({message:D,signature:C},E.outercarrier)}},z)},x)}},s)},q)}},l)},f)};this.verifySignature=function(c,a,b,g,f){var e=cipherJS.asym.hashMessage(c);b=cipherJS.asym.deserializePublicKey(b,"ecdsa");a=sjcl.codec.hex.toBits(a);var d={callback:g,outercarrier:f};b.verifyAsync(e,a,function(h,j){if(!h){b.verifyAsync(e,a,function(k,m){if(!k){b.verifyAsync(e,a,function(n,p){if(!n){b.verifyAsync(e,a,function(q,s){var r="unverified";if(q==true){r="verified"}s.callback({verified:r},s.outercarrier)},p)}else{var o="unverified";if(n==true){o="verified"}p.callback({verified:o},p.outercarrier)}},m)}else{var l="unverified";if(k==true){l="verified"}m.callback({verified:l},m.outercarrier)}},j)}else{var i="unverified";if(h==true){i="verified"}j.callback({verified:i},j.outercarrier)}},d)};this.encryptAndSignString=function(d,b,c,a,e,g,f){cipherJS.asym.signString(d,a,e,c,function(i,j){var h=i.signature;cipherJS.asym.encryptString(b,d,function(k,l){k.signature=h;g(k,l)},j)},f)};this.decryptAndVerifyString=function(b,e,f,i,c,a,d,g,h){cipherJS.asym.decryptString(b,e,f,i,c,function(k,j){j={carrier:j,cleartext:k.cleartext};cipherJS.asym.verifySignature(k.cleartext,a,d,function(l,m){l.cleartext=m.cleartext;g(l,m.carrier)},j)},h)};this.checkKeypair=function(d,c,b){var a=cipherJS.asym.checkPublicKey(d,b);var e=cipherJS.asym.checkSecretKey(c,b);if(a&&e){return true}else{return false}};this.checkPublicKey=function(a){try{return a._point.isValid()}catch(b){return false}};this.checkSecretKey=function(c,b){if(typeof c=="String"||typeof c=="string"){try{var f=cipherJS.asym.deserializeSecretKey(c,b);if((typeof f=="object"||typeof f=="Object")&&f!=null){return true}else{return false}}catch(d){return false}}else{try{var a=cipherJS.asym.serializeSecretKey(c,b);var f=cipherJS.asym.deserializeSecretKey(a,b);if((typeof f=="object"||typeof f=="Object")&&f!=null){return true}else{return false}}catch(d){return false}}};this.serializeSecretKey=function(d,c){var e=d._exponent.toBits();var f=d._curve.b.exponent;var g=c;var b={exponent:e,curve:f,keytype:g};var a=JSON.stringify(b);return a};this.deserializeSecretKey=function(c,b){try{c=JSON.parse(c)}catch(f){console.log(c);try{c=JSON.parse(c)}catch(f){c=JSON.parse(c)}}var d=c.exponent;var g=c.curve;d=sjcl.bn.fromBits(d);if(b=="ecdsa"){var a=new sjcl.ecc.ecdsa.secretKey(sjcl.ecc.curves["c"+g],d)}else{var a=new sjcl.ecc.elGamal.secretKey(sjcl.ecc.curves["c"+g],d)}return a};this.serializePublicKey=function(c,b){var a=c._point.toBits();var f=c._curve.b.exponent;var g=b;var e={point:a,curve:f,keytype:g};var d=JSON.stringify(e);return d};this.deserializePublicKey=function(d,b){d=JSON.parse(d);var f=d.point;var i=d.curve;var a;try{a=sjcl.ecc.curves["c"+i].fromBits(f)}catch(g){try{a=sjcl.ecc.curves["c"+i].fromBits(f)}catch(g){try{a=sjcl.ecc.curves["c"+i].fromBits(f)}catch(g){a=sjcl.ecc.curves["c"+i].fromBits(f)}}}var h=a.isValid();if(b=="ecdsa"){var c=new sjcl.ecc.ecdsa.publicKey(a.curve,a)}else{var c=new sjcl.ecc.elGamal.publicKey(a.curve,a)}return c};this.symEncryptAsync=function(d,b,e,c){var a=cipherJS.asym.symmetricAlgorithm;cipherJS.sym.encryptAsync(d,b,a,function(f,g){e(f,g)},c)};this.symDecryptAsync=function(c,a,d,b){cipherJS.sym.decryptAsync(c,a,function(f,e){d(f,e)},b)};this.symEncrypt=function(d,c){var b=cipherJS.asym.symmetricAlgorithm;var a=cipherJS.sym.encrypt(d,c,b);return a};this.symDecrypt=function(b,a){var c=cipherJS.sym.decrypt(b,a);return c};this.hashPublicKey=function(a){var c=sjcl.hash.sha1.hash(a);c=sjcl.codec.hex.fromBits(c);var b=sjcl.hash.sha1.hash(a);b=sjcl.codec.hex.fromBits(b);if(c==b){return c}else{c=sjcl.hash.sha1.hash(a);c=sjcl.codec.hex.fromBits(c);b=sjcl.hash.sha1.hash(a);b=sjcl.codec.hex.fromBits(b);return c}};this.hashMessage=function(b){var a;a=sjcl.hash.sha256.hash(b);a=sjcl.codec.hex.fromBits(a);return a};this.randomKeyString=function(b,c){if(b===undefined||b=="undefined"){b=64}var g="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";if(c=="hex"){g="012345678abcdef"}var f=b;var a="";for(var d=f;d>0;--d){var e=sjcl.random.randomWords(1,10);e=e[0];if(e<0){e=e*(-1)}e="0."+e;e=parseFloat(e);a+=g[Math.round(e*(g.length-1))]}return a}}cipherJS.asym=new cipher_js_asym();function cipher_js_simple_asym(){this.generateKeyset=function(b,a,d,c){if(b!=256&&b!=521){b=521}cipherJS.asym.generateKeys(b,a,function(e,f){setTimeout(function(){if(e==null){d(null,f)}var k=e.encryption.pub;var j=e.encryption.sec;var i=e.signing.pub;var g=e.signing.sec;var l=k+i;l=sjcl.hash.sha256.hash(l);l=sjcl.codec.hex.fromBits(l);e="<keyset><id>"+l+"</id><encryption><pub>"+k+"</pub><sec>"+j+"</sec></encryption><signing><pub>"+i+"</pub><sec>"+g+"</sec></signing></keyset>";var h="<publickeyset><id>"+l+"</id><encryption><pub>"+k+"</pub></encryption><signing><pub>"+i+"</pub></signing></publickeyset>";d({keyset:e,publickeyset:h},f)},1)},c)};this.printId=function(a){var e=cipherJS.asym.simple.parseKeyset(a);var c=e.encryption.pub;var b=e.signing.pub;var d=c+b;d=sjcl.hash.sha256.hash(d);d=sjcl.codec.hex.fromBits(d);return d};this.encryptMessage=function(a,e,h,g,d){var b=new Array();for(var c=0;c<a.length;c++){var f=cipherJS.asym.simple.parseKeyset(a[c]);b.push(f.encryption.pub)}cipherJS.asym.encryptString(b,e,function(k,p){var o="<ct>"+k.ciphertext+"</ct>";var i=k.enckeys;var n="";var m;for(var l=0;l<i.length;l++){m=i[l];n+="<ek id='"+l+"'><kh>"+m.keyhash+"</kh><ck>"+m.cipherkey+"</ck><kt>"+m.keytag+"</kt></ek>"}n="<eks>"+n+"</eks>";var q="<message><type>encrypted</type><version>0.0.1</version>"+n+o+"</message>";h(q,p)},g,d)};this.decryptMessage=function(p,e,k,m,o){var d=cipherJS.asym.simple.parseKeyset(e);var n=cipherJS.asym.hashPublicKey(d.encryption.pub);var j=p.between("<eks>","</eks>");var g=p.between("<ct>","</ct>");var f=0;var c=false;var a;var b;var l;var h;while(!c){a=j.between("<ek id='"+f+"'>","</ek>");if(a!=null){b=a.between("<kh>","</kh>");if(b==n){l=a.between("<ck>","</ck>");h=a.between("<kt>","</kt>")}}else{c=true}f+=1}cipherJS.asym.decryptString(g,d.encryption.sec,k,l,h,function(i,q){m(i.cleartext,q)},o)};this.signMessage=function(b,e,c,f,d){var a=cipherJS.asym.simple.parseKeyset(e);cipherJS.asym.signString(b,a.signing.sec,c,a.signing.pub,function(h,j){var g=h.signature;var i=h.message;var k="<message><type>signed</type><version>0.0.1</version><ct>"+i+"</ct><sig>"+g+"</sig></message>";f(k,j)},d)};this.verifyMessage=function(e,g,h,f){var b=e.between("<ct>","</ct>");var c=e.between("<sig>","</sig>");var a=cipherJS.asym.simple.parseKeyset(g);var d=a.signing.pub;cipherJS.asym.verifySignature(b,c,d,function(i,j){h(i.verified,j)},f)};this.encryptAndSignMessage=function(b,f,g,k,h,j,a){var l=new Array();for(var e=0;e<b.length;e++){var d=cipherJS.asym.simple.parseKeyset(b[e]);l.push(d.encryption.pub)}var c=cipherJS.asym.simple.parseKeyset(f);cipherJS.asym.encryptAndSignString(k,l,c.signing.pub,c.signing.sec,g,function(r,t){var o="<ct>"+r.ciphertext+"</ct>";var n="<sig>"+r.signature+"</sig>";var s=r.enckeys;var p="";var m;for(var q=0;q<s.length;q++){m=s[q];p+="<ek id='"+q+"'><kh>"+m.keyhash+"</kh><ck>"+m.cipherkey+"</ck><kt>"+m.keytag+"</kt></ek>"}p="<eks>"+p+"</eks>";var i="<message><type>encrypted,signed</type><version>0.0.1</version>"+p+o+n+"</message>";h(i,t)},j,a)};this.decryptAndVerifyMessage=function(n,l,a,k,h,q){var o=cipherJS.asym.simple.parseKeyset(l);var e=cipherJS.asym.hashPublicKey(o.encryption.pub);var s=cipherJS.asym.simple.parseKeyset(k);var j=s.signing.pub;var g=n.between("<ct>","</ct>");var d=n.between("<sig>","</sig>");var r=n.between("<eks>","</eks>");var p=0;var b=false;var c;var f;var m;var t;while(!b){c=r.between("<ek id='"+p+"'>","</ek>");if(c!=null){f=c.between("<kh>","</kh>");if(f==e){m=c.between("<ck>","</ck>");t=c.between("<kt>","</kt>")}}else{b=true}p+=1}cipherJS.asym.decryptAndVerifyString(g,o.encryption.sec,a,m,t,d,j,function(u,i){h(u,i)},q)};this.parseKeyset=function(f){var d=new Object();d.encryption=new Object();d.signing=new Object();var h=f.between("<encryption>","</encryption>");var i=f.between("<signing>","</signing>");var e;var g;var b;var c;e=h.between("<pub>","</pub>");b=i.between("<pub>","</pub>");d.encryption.pub=e;d.signing.pub=b;if(f.indexOf("<publickeyset>")<0){g=h.between("<sec>","</sec>");c=i.between("<sec>","</sec>");d.encryption.sec=g;d.signing.sec=c}var j=f.between("<id>","</id>");var a=e+b;a=sjcl.hash.sha256.hash(a);a=sjcl.codec.hex.fromBits(a);if(j!=a){return null}return d}}cipherJS.asym.simple=new cipher_js_simple_asym();